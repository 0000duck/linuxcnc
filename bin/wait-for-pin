#!/bin/bash
MAX_WAIT=${2-20}

N=0
while sleep .1; do
    count=$(halcmd -q show pin $1 | wc -l)
    case $count in
    3) ;;
    4)
        break ;;
    *)
        echo "Unexpected number of output lines from halcmd: $count"
        exit 2
    esac
    if [ $N -gt $MAX_WAIT ]; then
        exit 1
    fi
    N=$(($N+1))
    echo -n "." 1>&2
done
if [ $N -gt 0 ]; then echo 1>&2; fi
