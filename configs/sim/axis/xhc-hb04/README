These sim configurations demonstrate use of an XHC-HB04 wireless MPG pendant in LinuxCNC using a HAL module created by Frederic Rible (frible@teaser.fr) (Copyright (C) 2013).  Ref:

http://wiki.linuxcnc.org/cgi-bin/wiki.pl?Using_A_XHC-HB04_Wireless_MPG_Pendant

The HAL module is designed for the XHC-HB04 V3.0 identified as USB device 10CE:EB70.
Most of the pendant features are handled:
- buttons converted to hal pins
- jog wheel with variable scale (use stepsize-up pin to change in 1 10 100 1000 sequence)
- LCD screen displays machine and relative positions

Sim configurations are provided for two known button configurations:

layout1 -- 16 buttons
layout2 -- 18 buttons (more common)

A working and connected xhc-hb04 device is required for the demonstration.  If not connected, the sim configs will start without pendant functionality.

A udev rules file:
  /etc/udev/rules.d/90-xhc.rules
must be added to the system to give correct user permissions for USB access:
SYSFS{idProduct}=="eb70", SYSFS{idVendor}=="10ce", MODE="666", OWNER="root", GROUP="users"

Or for later operating systems (like ubuntu12.x):
ATTR{idProduct}=="eb70", ATTR{idVendor}=="10ce", MODE="666", OWNER="root", GROUP="users"

The sim configurations use a single halfile: xhc-hb04.tcl.  This halfile uses a custom comp file (xhc_hb04_util.comp) and can be added to existing configurations by adding an ini file entry for:
  [HAL]HALFILE=xhc-hb04.tcl

This HALFILE entry should follow other HALFILE entries.

Optional configuration ini file items and the defaults values are:

[XHC_HB04_CONFIG]
layout     = 2       (1|2)
coords     = x y z a (4 max)
coefs      = 1 1 1 1 (filter coefs 0 < coef < 1)
scales     = 1 1 1 1 (plus/minus factors)
threadname = servo-thread
require_pendant = yes 
jogmode    = normal  (normal | vnormal | plus-minus)

The filter coefs can be used to slow the response to wheel steps but are usually not needed since the xhc-hb04 component implements smoothing.  The movement per wheel increment is set by connecting the STEP button to the hal pin xhc-hb04.stepsize-up (values: 1 10 100 1000).  The scale factor for each axis can be set with the scales item.

When require_pendant = no, the xhc-hb04 hal pins will be created even if the pendant is not connected at startup.  A new connection, a disconnect, and a reconnect are supported.
----------------------------------
jogmodes:
  normal: postion mode, the axis will move exactly regardless of how long it takes.  Beware: the machine may keep moving after you stop rotating the jog wheel.

  vnormal: velocity mode, the axis will stop when the wheel stops.  Beware: the amount moved per wheel detent may be less than specified if the machine velocity and acceleration cannot accomplish the move in time.

  plus-minus: halui plus-minus jogging.

----------------------------------
Pendant buttons are connected to hal pins with ini file items.
Examples:
[XHC_HB04_BUTTONS]
step        = xhc-hb04.stepsize-up
stop        = halui.program.stop
rewind      = halui.program.step
goto-zero   = halui.mdi-command-00
macro-1     = halui.mdi-command-01
mode        = ""  (placeholder)

Note: MDI commands are defined in a [HALUI] stanza:
[HALUI]
MDI_COMMAND = G0 X0 Y0 Z0
MDI_COMMAND = M101

An xhc-hb04 pendant can be added to existing configurations.
  1) copy files to the configuration directory:
     $ cp xhc-hb04.tcl         your_config_dir/
     $ cp monitor_xhc-hb04.tcl your_config_dir/
     $ cp xhc-hb04-layout*.cfg your_config_dir/
  2) Edit existing configuration ini file to:
    a) add [HAL]HALFILE=xhc-hb04.tcl
    b) add [HAL]HALFILE=monitor_xhc-hb04.tcl
    c) add stanza [XHC-HB04_CONFIG]
    d) add stanza [XHC-HB04_BUTTONS]
    e) add or update stanza for [HALUI]

See the demo ini files for more detailed examples.
