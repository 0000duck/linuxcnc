:lang: fr

= Mettre à jour LinuxCNC

[[cha:mettre_a_jour_linuxcnc,Mettre à jour LinuxCNC]]

Cette section décrit comment mettre à jour LinuxCNC de la version 2.6 vers
la version 2.7. Ce qui suppose qu'une version 2.6 est déjà installée et
qu'elle doit passer en version 2.7.

Pour mettre à jour LinuxCNC vers la version 2.7 depuis une version
antérieure à la 2.6, il est nécessaire de commencer par une mise à jour en
version 2.6, puis de suivre les instructions pour la mise à jour en version
2.7.

Pour une version plus ancienne encore, il est préférable de repartir d'une
nouvelle installation complète directement en version 2.7 comme décrit dans
la section <<cha:se_procurer_linuxcnc,Se procurer LinuxCNC>>.


== Mise à jour vers une nouvelle version

L'idée de base consiste à invalider les anciennes sources apt de
linuxcnc.org et à ajouter les sources pour la version 2.7, puis de mettre à
jour LinuxCNC.

Les détails vont dépendre de la distribution sur laquelle on
travaille. Lancer `lsb_release -ic` pour obtenir cette information en
sortie:

-----
> lsb_release -ic
Distributor ID: Debian
Codename:       wheezy
-----

Il faut être sur une distribution Debian Wheezy (comme dans l'exemple
précédent), ou dans une Ubuntu Precise, ou Ubuntu Lucid.

[[sec:ajuster_les_sources_apt,Ajuster les sources apt]]

=== Ajuster les sources apt

* Ouvrir la fenêtre `Sources de logiciels`. La procédure va un peu différer
  selon les 3 distributions supportées:

** Debian Wheezy:

*** Cliquer sur `Menu Applications`, puis `Système`, et enfin
  `Gestionnaire de paquets Synaptic`.

*** Dans Synaptic, cliquer sur le menu `Réglages`, puis cliquer sur `Dépôts`
  pour ouvrir la fenêtre `Sources de logiciels`.

** Ubuntu Precise:

*** Cliquer sur l’icône  `tableau de bord` dans le coin en haut à gauche.

*** Dans le champ `Rechercher`, taper "software", puis cliquer sur l'icône `Centre
  de logiciels Ubuntu`.

*** Dans la fenêtre du centre de logiciels Ubuntu, cliquer surle menu `Editer`,
  puis cliquer sur `Sources de logiciels...` pour ouvrir la fenêtre des `Sources de logiciels`.

** Ubuntu Lucid:

*** Cliquer sur le menu `Système`, puis sur `Administration`, et
  `Gestionnaire de paquets Synaptic`.

*** Dans Synaptic, cliquer sur le menu `Réglages`, puis cliquer sur `Dépôts`
  pour ouvrir la fenêtre `Sources de logiciels`.

* Dans la fenêtre `Sources de logiciels`, sélectionner l'onglet `Autres
  logiciels`.

* Effacer ou décocher toutes les anciennes entrées linuxcnc.org (laisser
  toutes celles ne concernant pas linuxcnc.org).

* Cliquer sur le bouton `Ajouter` et ajouter une nouvelle ligne apt.  La
  ligne sera légèrement différente selon les plate-forme:

[options="header"]
|===================================================================
| Plate-forme       | ligne source apt
| Debian Wheezy  | `deb http://linuxcnc.org wheezy base 2.7-rtai`
| Ubuntu Precise | `deb http://linuxcnc.org precise base 2.7-rtai`
| Ubuntu Lucid   | `deb http://linuxcnc.org lucid base 2.7-rtai`
|===================================================================

image::images/upgrading-to-2.7.png[align="left"]

* Cliquer sur `Ajouter la source`, puis `Fermer` dans la fenêtre des sources
  de logiciels.  Si des fenêtre surgissantes indiquent que des informations
  sont périmées, cliquer sur le bouton `Recharger`.


=== Mettre à jour vers une nouvelle version

Maintenant que l'ordinateur connaît où aller chercher la nouvelle version de
logiciel, il ne reste plus qu'à l'installer.

De nouveau, la procédure sera différente selon les distributions.

==== Debian Wheezy et Ubuntu Lucid

Debian Wheezy et Ubuntu Lucid utilisent tous les deux le gestionnaire de
paquets Synaptic.

Ouvrir Synaptic en suivant le paragraphe
<<sec:ajuster_les_sources_apt,Ajuster les sources apt>>

* Cliquer le bouton `Recharger`.

* Utiliser la fonction de recherche pour `linuxcnc`.

* Cliquer la case à cocher pour marquer les nouveaux paquets linuxcnc et
  linuxcnc-doc-* à mettre à jour.  Le gestionnaire de paquets peux
  sélectionner certains paquets additionnels à installer, pour satisfaire
  les dépendances envers les nouveaux paquets de linuxcnc.

* Cliquer sur le bouton `Appliquer`, et laisser l'ordinateur installer les
  nouveaux paquets. Les anciens paquets linuxcnc seront automatiquement mis
  à jour par la nouveaux.


=== Ubuntu Precise

* Cliquer sur l'icône `Tableau de bord` en haut à gauche.

* Dans le champ `Rechercher`, taper "update", puis cliquer sur l'icône du
  `Gestionnaire de mises à jour`.

* Cliquer sur le bouton `Choisir` pour obtenir la liste des paquets
  disponibles.

* Cliquer sur le bouton `Installer les mises à jour` pour installer les
  nouvelles versions des paquets.


== Mettre à jour la configuration

LinuxCNC en version 2.7 diffère de la version 2.6 sur plusieurs points qui
requiert des modifications de configuration de la machine.


=== Hostmot2 Watchdog

Le watchdog de Hostmot2 doit maintenant être manipulé par la fonction Hal
`write` de hm2.  Il n'est plus nécessaire de lancer la fonction Hal
`pet-watchdog` de Hm2.  La fonction `pet-watchdog` sera supprimée avant la
sortie de la version 2.7.0.


=== Changements concernant Parport

Les anciennes versions du pilote `hal_parport` de LinuxCNC étaient en
conflit avec le pilote `parport_pc` de Linux.  Ce qui nécessitait deux
techniques d’atténuation: nous empêchions `parport_pc` de se charger et nous
chargions un autre pilote appelé `probe_parport` avant de charger
`hal_parport`.

Le pilote `hal_parport` de LinuxCNC coopère maintenant avec le pilote
`parport_pc` de Linux, ces techniques d'atténuations ne sont donc plus, ni
nécessaires, ni utiles.  En version 2.7, le pilote `probe_parport` a été
retiré de LinuxCNC.

Ce qui veux dire que les configurations utilisant le port parallèle peuvent
demander à être mises à jour de la manière suivante:

* Être sûr que LinuxCNC n'empêche pas le pilote `parport_pc` de Linux
  de se charger.  Les anciennes versions de LinuxCNC blacklistaient `parport_pc`
  dans `/etc/modprobe.d/linuxcnc.conf` (ou `/etc/modprobe.d/emc2.conf`
  pour les plus anciennes versions de LinuxCNC).  Modifier toutes
  ces lignes dans tous ces fichiers comme ça:
  +
  `install parport_pc /bin/true`

* Être sûr que la configuration de Hal ne charge pas le composant
  `probe_parport`.


// vim: set syntax=asciidoc:
