#!/bin/bash
CC="$1"; shift
LHS="$1"; shift
DEST="$1"; shift
trap "rm -f $DEST.tmp" INT QUIT TERM
$CC -M "$@" | sed "1s|^.*:|$LHS:|" > $DEST.tmp
result=${PIPESTATUS[0]}
case $result in
0) mv $DEST.tmp $DEST ;;
*) rm -f $DEST.tmp    ;;
esac
exit $result
