#!/bin/bash
CC="$1"; shift
LHS="$1"; shift
DEST="$1"; shift
trap "rm -f $DEST.tmp*" INT QUIT TERM
set -e
(set -x; $CC -M "$@" > $DEST.tmp.1)
sed "1s|^.*:|$LHS:|" < $DEST.tmp.1 > $DEST.tmp
mv $DEST.tmp $DEST
